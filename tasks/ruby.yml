--- 
# Compile ruby as per gitlab requirements
- name: Get ruby
  get_url:
    url=ftp://ftp.ruby-lang.org/pub/ruby/2.0/ruby-2.0.0-p353.tar.gz
    dest=/tmp/

- name: Prepare the unarchive target directory
  file:
    path=/tmp/ruby/
    state=directory

- name: Unpack ruby
  unarchive:
    src=/tmp/ruby-2.0.0-p353.tar.gz
    dest=/tmp/ruby/
    copy=no

- name: install ruby
  shell: "{{ item }} chdir=/tmp/ruby/ruby-2.0.0-p353"
  with_items:
    - './configure --disable-install-rdoc'
    - 'make'
    - 'make install'

- name: Disable rubygems ri and rdoc
  lineinfile:
    dest=/usr/local/etc/gemrc
    line="{{ 'gem:' + ' --no-ri --no-rdoc' }}"
    create=yes
    state=present

- name: Install bundler gem
  gem:
    name=bundler
    state=latest
    user_install=no
